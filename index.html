<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ</title>

<!-- Google Fonts for Markazi Text -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-1:#f5f2ea;
    --bg-2:#e6e2d9;
    --ink:#0e1c1c;
    --pill:#0e3a3a;
    --pillText:#e8f0ef;
    --chip:#e9e4da;

    --ok:#28a745;
    --no:#e74c3c;
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0; overflow:hidden;}
  body{
    font-family: 'Markazi Text', serif;
    color:var(--ink);
    background: radial-gradient(1200px 700px at 50% 20%, var(--bg-1), var(--bg-2));
    user-select:none;
  }

  /* screens */
  .screen{display:none; width:100vw; height:100vh; padding:12px}
  .screen.active{display:flex}
  #start-screen, #result-screen{align-items:center; justify-content:center; flex-direction:column; gap:20px}

  /* logo + title */
  .logo-tile{
    width:min(150px,20vmin); height:min(150px,20vmin);
    border-radius:20px; display:grid; place-items:center;
    background:#ffffffdd; border:3px solid #3c4747; box-shadow:0 10px 24px rgba(20,20,20,.08);
    font-size:min(72px,9vmin);
  }
  .title{ font-size:min(48px,7vmin); font-weight:700; letter-spacing:.5px; text-shadow:0 6px 18px rgba(0,0,0,.08); }
  .btn{
    cursor:pointer; border:none; outline:none;
    padding:12px 22px; font-size:24px; border-radius:16px;
    background:linear-gradient(180deg,#bfe0f3,#9dc3da);
    color:#0b1e25; border:3px solid #515b5f; box-shadow:0 10px 24px rgba(0,0,0,.08);
  }
  .btn:active{transform:translateY(1px)}

  .back{
    width:46px; height:46px; border-radius:12px;
    display:grid; place-items:center; background:#ffffffcc; border:3px solid #314445; cursor:pointer;
    box-shadow:0 8px 20px rgba(0,0,0,.08);
    font-size:26px;
  }

  /* game layout */
  #game-screen{
    flex-direction:column; gap:8px; padding:12px;
    /* alttaki sabit zaman √ßizgisi ile √ßakƒ±≈ümayƒ± √∂nlemek i√ßin bo≈üluk */
    padding-bottom:max(12px,76px);
  }

  .top-area {
    display:flex;
    justify-content:space-between;
    align-items:center;
    width:100%;
    gap:8px;
    flex-wrap:wrap;
  }

  .player{
    display:flex;
    align-items:center;
    justify-content:space-between;
    font-size:clamp(16px,2.4vmin,24px);
    background:var(--chip);
    color:var(--ink);
    padding:8px 12px;
    border-radius:16px;
    border:2px solid #bcaea1;
    box-shadow:0 4px 10px rgba(0,0,0,0.06);
    flex:1 1 0;
    min-width:220px;
    max-width:49%;
  }
  .player-id-group, .player-score-group { display:flex; align-items:center; gap:8px; }
  .player .chip{
    background:var(--pill); color:var(--pillText); padding:6px 12px; border-radius:999px; border:2px solid #0b2b2b;
    min-width:42px; text-align:center; font-weight:700; font-size:clamp(16px,2.2vmin,22px);
  }
  .player .star{font-size:clamp(16px,2.2vmin,22px);}
  .player .id{display:flex; align-items:center; gap:6px; font-weight:700;}

  .arena{
    display:grid;
    grid-template-columns:1fr auto 1fr;
    gap:min(12px,1.2vmin);
    align-items:center;
    flex-grow:1;
    width:100%;
  }

  /* soru kutusu K√ú√á√úLT√úLD√ú */
  .question{
    width:clamp(200px,34vmin,440px);
    height:clamp(200px,38vmin,480px);
    background:#fff; border-radius:22px; border:3px solid #333; box-shadow:0 10px 24px rgba(0,0,0,.08);
    display:grid; place-items:center;
    padding:0; overflow:hidden;
  }
  .q-text{
    font-size:clamp(28px,9vmin,56px);
    font-weight:700; text-align:center; line-height:1.15; padding:8px;
  }
  .q-color{ width:100%; height:100%; }

  /* ≈üƒ±klar K√ú√á√úLT√úLD√ú + bo≈üluklar azaltƒ±ldƒ± */
  .side{
    display:grid;
    grid-template-columns:repeat(2, minmax(100px, 1fr));
    grid-auto-rows:minmax(100px, 1fr);
    gap:8px;
    justify-content:center;
    align-content:center;
  }
  .ans{
    border-radius:18px; border:3px solid rgba(0,0,0,.6); background:#fff;
    display:grid; place-items:center;
    font-family:'Markazi Text', serif;
    font-size:clamp(18px,4.2vmin,32px);
    font-weight:700; text-align:center;
    padding:8px;
    cursor:pointer;
    box-shadow:0 6px 14px rgba(0,0,0,.06);
    position:relative;
    transition:transform .18s ease-out, box-shadow .14s ease, border-color .14s ease;
  }
  .ans:active{transform:translateY(1px)}
  .ans.disabled{pointer-events:none;}
  .ans.selected{transform:scale(0.95); box-shadow:0 0 0 3px #4a90e2;}
  .ans.color{border:none}
  .ans.correct{ border-color:var(--ok)!important; box-shadow:0 0 0 4px var(--ok); transform:scale(1.06); }
  .ans.wrong{ border-color:var(--no)!important; box-shadow:0 0 0 4px var(--no); animation:shake .45s ease-in-out; }

  .ans.correct::after, .ans.wrong::after {
    font-family:system-ui,sans-serif; position:absolute; top:6px; right:10px;
    font-size:34px; font-weight:bold; color:white;
  }
  .ans.correct::after { content:'‚úî'; text-shadow:0 0 6px var(--ok), 0 0 4px var(--ok); }
  .ans.wrong::after   { content:'‚úñ'; text-shadow:0 0 6px var(--no), 0 0 4px var(--no); }

  @keyframes shake {
    10%, 90% { transform: translateX(-2px) scale(0.95); }
    20%, 80% { transform: translateX(4px) scale(0.95); }
    30%, 50%, 70% { transform: translateX(-5px) scale(0.95); }
    40%, 60% { transform: translateX(5px) scale(0.95); }
  }

  .point-animation{
    position:fixed; z-index:100; font-size:40px; font-weight:bold; color:#ffc107;
    text-shadow:0 0 5px black; pointer-events:none; animation:fly-up 1.2s ease-out forwards;
  }
  @keyframes fly-up{
    0%{transform:translate(-50%,-50%) scale(0.5); opacity:1;}
    100%{transform:translate(-50%,-220%) scale(1.1); opacity:0;}
  }

  .card{
    width:min(620px,94vw); background:#fff; border:3px solid #3e4245; border-radius:22px; padding:24px 18px; text-align:center;
    box-shadow:0 16px 32px rgba(0,0,0,.08);
  }
  .cup{font-size:min(100px,12vmin); margin-bottom:8px}
  .rank{display:grid; gap:12px; margin:12px auto 6px}
  .row{ display:flex; align-items:center; justify-content:center; gap:10px; }
  .row .player-pill{
    background:var(--pill); color:var(--pillText); border:3px solid #0b2b2b; border-radius:999px; padding:6px 12px; display:flex; align-items:center; gap:8px;
  }
  .row .score-chip{background:var(--chip); color:#1d2a2a; padding:2px 10px; border-radius:999px; border:2px solid #4f5a5a; min-width:50px; font-weight:700}
  .again{margin-top:16px}

  .overlay{
    position:fixed; inset:0; background:rgba(240,239,235,.92); display:none; align-items:center; justify-content:center; z-index:9;
  }
  .overlay.active{display:flex}
  .count{
    font-size:min(160px,22vmin); font-weight:800; text-shadow:0 16px 32px rgba(0,0,0,.12); animation:pop .6s ease both;
  }
  @keyframes pop{0%{transform:scale(.6); opacity:.2} 60%{transform:scale(1.05); opacity:1} 100%{transform:scale(1)}}

  /* === SABƒ∞T ALT ZAMAN √áƒ∞ZGƒ∞Sƒ∞ (KUTU DI≈ûINDA) === */
  .bottom-bar{
    position:fixed;
    bottom:max(8px, env(safe-area-inset-bottom));
    left:0; right:0; width:100%;
    display:flex; align-items:center; gap:8px;
    padding:0 8px;
    direction:ltr;
    z-index:20;
    pointer-events:none;
  }
  .bottom-bar > * { pointer-events:auto; }

  .timer{
    position:relative;
    flex-grow:1; height:42px;
    background:#ff5b58;
    border-radius:999px; border:3px solid #ab2a2a;
    overflow:hidden; box-shadow:inset 0 2px 2px rgba(0,0,0,.1);
    width:100%;
  }
  .timer .bar{
    position:absolute; right:0; top:0; bottom:0; width:100%;
    background:#ffffff; border-radius:999px;
  }
  .timer .spark{
    position:absolute; right:-26px; top:50%; transform:translateY(-50%);
    width:52px; height:52px; border-radius:50%; background:#e53935;
    box-shadow:0 0 0 4px #fff, 0 0 16px 8px rgba(255,90,88,.55);
    border:3px solid #ab2a2a;
  }

  /* MOBƒ∞L SIKILA≈ûTIRMA */
  @media (max-width:900px){
    #game-screen{ gap:6px; padding:8px; padding-bottom:max(10px,72px); }

    .arena{
      grid-template-columns:1fr;
      grid-template-rows:auto auto auto;
      gap:8px;
    }
    #left-answers{ grid-row:1; }
    #question-box{ grid-row:2; }
    #right-answers{ grid-row:3; }

    .side{
      grid-template-columns:repeat(2, minmax(88px, 1fr));
      grid-auto-rows:minmax(88px, 1fr);
      gap:6px;
    }
    .question{
      width:clamp(180px, 46vw, 380px);
      height:clamp(180px, 48vw, 420px);
    }
    .q-text{ font-size:clamp(24px,8.5vmin,48px); }
    .ans{ font-size:clamp(16px,4.2vmin,28px); padding:6px; border-width:3px; }
    .top-area{ gap:6px; }
    .player{ padding:6px 10px; border-width:2px; }
    .bottom-bar{ bottom:max(6px, env(safe-area-inset-bottom)); padding:0 6px; gap:6px; }
    .timer{ height:38px; }
    .back{ width:42px; height:42px; font-size:24px; }
  }

  /* ULTRA DAR EKRANLAR (<= 360px geni≈ülik) */
  @media (max-width:360px){
    .side{ grid-template-columns:repeat(2, minmax(80px,1fr)); grid-auto-rows:minmax(80px,1fr); gap:5px; }
    .question{ width:72vw; height:72vw; }
    .timer{ height:34px; }
  }
</style>
</head>
<body>

<!-- START SCREEN -->
<section id="start-screen" class="screen active">
  <div class="logo-tile" aria-hidden="true">üé®</div>
  <div class="title">ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿßŸÑÿ£ŸÑŸàÿßŸÜ</div>
  <button id="start-btn" class="btn">ÿßÿ®ÿØÿ£</button>
</section>

<!-- GAME SCREEN -->
<section id="game-screen" class="screen" aria-live="polite">
  <div class="top-area">
    <div class="player" id="p1">
      <div class="player-score-group">
        <span class="chip" id="p1-score">0</span>
        <span class="star" aria-hidden="true">‚≠ê</span>
      </div>
      <div class="player-id-group">
        <span class="id"><span aria-hidden="true">üë§</span> <span class="num">1</span></span>
      </div>
    </div>

    <div class="player" id="p2">
      <div class="player-score-group">
        <span class="chip" id="p2-score">0</span>
        <span class="star" aria-hidden="true">‚≠ê</span>
      </div>
      <div class="player-id-group">
        <span class="id"><span aria-hidden="true">üë§</span> <span class="num">2</span></span>
      </div>
    </div>
  </div>

  <div class="arena">
    <div class="side" id="left-answers"></div>

    <div class="question" id="question-box">
      <div class="q-text" id="q-text" style="display:none"></div>
      <div class="q-color" id="q-color" style="display:none"></div>
    </div>

    <div class="side" id="right-answers"></div>
  </div>

  <!-- SABƒ∞T ALT BAR (KUTU DI≈ûINDA) -->
  <div class="bottom-bar">
    <div class="back" id="back-home" title="ÿπŸàÿØÿ©">‚Üê</div>
    <div class="timer" aria-label="ŸÖÿ§ŸÇŸëÿ™">
      <div class="bar" id="time-bar"></div>
      <div class="spark" id="spark"></div>
    </div>
  </div>
</section>

<!-- RESULT SCREEN -->
<section id="result-screen" class="screen">
  <div class="card">
    <div class="cup">üèÜ</div>
    <div class="rank" id="rank"></div>
    <button id="play-again" class="btn again">ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÑÿπÿ®ÿ©</button>
  </div>
</section>

<!-- COUNTDOWN OVERLAY -->
<div id="overlay" class="overlay"><div class="count" id="count"></div></div>

<script>
  // ----- Data -----
  const COLORS = [
    { name: "ÿ£Ÿéÿ≤Ÿíÿ±ŸéŸÇ",   hex: "#38b6ff" },
    { name: "ÿ®Ÿèÿ±Ÿíÿ™ŸèŸÇŸéÿßŸÑŸêŸäŸë", hex: "#ff751f" },
    { name: "ŸàŸéÿ±ŸíÿØŸêŸäŸë",  hex: "#ff66c4" },
    { name: "ÿ®ŸèŸÜŸëŸêŸäŸë",   hex: "#734500" },
    { name: "ÿ£ŸéÿÆŸíÿ∂Ÿéÿ±",   hex: "#00bf63" },
    { name: "ÿ£Ÿéÿ®ŸíŸäŸéÿ∂",   hex: "#ffffff" },
    { name: "ÿ£Ÿéÿ≠ŸíŸÖŸéÿ±",   hex: "#ff3131" },
    { name: "ÿ£Ÿéÿ≥ŸíŸàŸéÿØ",   hex: "#000000" },
    { name: "ÿ®ŸéŸÜŸéŸÅŸíÿ≥Ÿéÿ¨ŸêŸäŸë", hex: "#542ca3" },
    { name: "ÿ£ŸéÿµŸíŸÅŸéÿ±",   hex: "#ffde59" }
  ];

  const ROUNDS = 10;
  const QUESTION_TIME = 10 * 1000;

  // ----- Elements -----
  const screens = {
    start: document.getElementById('start-screen'),
    game: document.getElementById('game-screen'),
    result: document.getElementById('result-screen'),
  };

  const p1ScoreEl = document.getElementById('p1-score');
  const p2ScoreEl = document.getElementById('p2-score');
  const leftAnswers  = document.getElementById('left-answers');
  const rightAnswers = document.getElementById('right-answers');
  const questionBox = document.getElementById('question-box');
  const qText  = document.getElementById('q-text');
  const qColor = document.getElementById('q-color');
  const timeBar = document.getElementById('time-bar');
  const spark   = document.getElementById('spark');
  const overlay = document.getElementById('overlay');
  const countEl = document.getElementById('count');
  const rankBox = document.getElementById('rank');

  // ----- State -----
  let scores, roundIndex, timerId;
  let current, type;
  let firstCorrectBy = null;
  let answered = { p1:false, p2:false };
  let choices = { p1: null, p2: null };
  let acceptingAnswers = false;

  function shuffle(arr){ return [...arr].sort(()=>Math.random()-0.5); }

  function toArabicIndic(numString){
    const map = {'0':'Ÿ†','1':'Ÿ°','2':'Ÿ¢','3':'Ÿ£','4':'Ÿ§','5':'Ÿ•','6':'Ÿ¶','7':'Ÿß','8':'Ÿ®','9':'Ÿ©'};
    return String(numString).replace(/[0-9]/g, d => map[d]);
  }

  function show(screen){
    Object.values(screens).forEach(s=>s.classList.remove('active'));
    screens[screen].classList.add('active');
  }

  function startCountdownThenGame(){
    overlay.classList.add('active');
    const seq = [3,2,1];
    let i=0;
    const tick = ()=>{
      if(i >= seq.length){
        overlay.classList.remove('active');
        beginGame();
        return;
      }
      countEl.textContent = toArabicIndic(seq[i]);
      countEl.classList.remove('pop'); void countEl.offsetWidth;
      countEl.classList.add('pop');
      i++;
      setTimeout(tick, 800);
    };
    tick();
  }

  function beginGame(){
    scores = { p1:0, p2:0 };
    p1ScoreEl.textContent = scores.p1;
    p2ScoreEl.textContent = scores.p2;
    roundIndex = 0;
    nextRound();
  }

  function nextRound(){
    clearTimer();
    if(roundIndex >= ROUNDS){ return finishGame(); }

    firstCorrectBy = null;
    answered = { p1:false, p2:false };
    choices = { p1: null, p2: null };
    acceptingAnswers = true;

    current = COLORS[Math.floor(Math.random()*COLORS.length)];
    type = Math.random() < 0.5 ? 'word' : 'color';

    questionBox.style.background = '#fff';
    questionBox.style.color = 'var(--ink)';

    if(type === 'word'){
      qText.style.display='block';
      qColor.style.display='none';
      qText.textContent = current.name;

      const opts = makeOptions(current, 3).map(o => o.hex);
      renderOptionsColor(leftAnswers, opts, 'p1');
      renderOptionsColor(rightAnswers, shuffle(opts), 'p2');
    }else{
      qText.style.display='none';
      qColor.style.display='block';
      questionBox.style.background = current.hex;
      if (current.hex === '#000000') questionBox.style.color = '#fff';

      const opts = makeOptions(current, 3).map(o => o.name);
      renderOptionsWords(leftAnswers, opts, 'p1');
      renderOptionsWords(rightAnswers, shuffle(opts), 'p2');
    }

    startTimer(QUESTION_TIME, ()=>advanceAfterTimeout());
    roundIndex++;
  }

  function makeOptions(target, nDistr){
    const others = shuffle(COLORS.filter(c=>c!==target)).slice(0, nDistr);
    return shuffle([target, ...others]);
  }

  function renderOptionsColor(root, options, player){
    root.innerHTML = '';
    options.forEach(hex=>{
      const btn = document.createElement('button');
      btn.className = 'ans color';
      btn.style.background = hex;
      btn.setAttribute('data-value', hex);
      btn.onclick = ()=>handleAnswer(player, hex);
      root.appendChild(btn);
    });
  }

  function renderOptionsWords(root, options, player){
    root.innerHTML = '';
    options.forEach(name=>{
      const btn = document.createElement('button');
      btn.className = 'ans';
      btn.textContent = name;
      btn.setAttribute('data-value', name);
      btn.onclick = ()=>handleAnswer(player, name);
      root.appendChild(btn);
    });
  }

  function handleAnswer(player, value){
    if(!acceptingAnswers || answered[player]) return;

    const isCorrect = (type === 'word')
      ? (value.toLowerCase() === current.hex.toLowerCase())
      : (value === current.name);

    answered[player] = true;

    const root = (player==='p1') ? leftAnswers : rightAnswers;
    const btn = [...root.children].find(b => b.getAttribute('data-value') === value);
    choices[player] = { element: btn, correct: isCorrect, animationElement: null };
    btn.classList.add('selected');

    if(isCorrect){
      if(firstCorrectBy === null){
        firstCorrectBy = player;
        addPoints(player, 10);
      }else if(firstCorrectBy !== player){
        addPoints(player, 5);
      }
    }

    [...root.children].forEach(b=>b.classList.add('disabled'));

    if(answered.p1 && answered.p2){
      clearTimer();
      setTimeout(revealResults, 350);
    }
  }

  function revealResults() {
    acceptingAnswers = false;
    for(const player of ['p1', 'p2']) {
      if(choices[player]) {
        choices[player].element.classList.remove('selected');
        choices[player].element.classList.add(choices[player].correct ? 'correct' : 'wrong');
        if(choices[player].correct && choices[player].animationElement) {
          document.body.appendChild(choices[player].animationElement);
        }
      }
    }
    setTimeout(nextRound, 1400);
  }

  function addPoints(player, pts){
    scores[player] += pts;
    const el = (player==='p1') ? p1ScoreEl : p2ScoreEl;
    el.textContent = scores[player];

    const anim = document.createElement('div');
    anim.className = 'point-animation';
    anim.textContent = `+${pts}`;

    const rect = choices[player].element.getBoundingClientRect();
    anim.style.left = `${rect.left + rect.width / 2}px`;
    anim.style.top = `${rect.top + rect.height / 2}px`;
    anim.addEventListener('animationend', () => anim.remove());
    choices[player].animationElement = anim;
  }

  function startTimer(durationMs, onEnd){
    const start = performance.now();
    function frame(now){
      const elapsed = now - start;
      const remain = Math.max(0, durationMs - elapsed);
      const remainingPct = remain / durationMs;

      timeBar.style.width = (remainingPct * 100).toFixed(2) + '%';
      spark.style.right = `calc(${(remainingPct * 100).toFixed(2)}% - 26px)`;

      if(remain <= 0){
        cancelAnimationFrame(timerId);
        timerId = null;
        onEnd?.();
        return;
      }
      timerId = requestAnimationFrame(frame);
    }
    cancelAnimationFrame(timerId);
    timerId = requestAnimationFrame(frame);
  }

  function clearTimer(){
    if(timerId){ cancelAnimationFrame(timerId); timerId=null; }
    timeBar.style.width = '100%';
    spark.style.right = 'calc(100% - 26px)';
  }

  function advanceAfterTimeout(){
    acceptingAnswers = false;
    revealResults();
  }

  function finishGame(){
    show('result');
    rankBox.innerHTML = '';
    const order = [
      { id:'1', key:'p1', score:scores.p1 },
      { id:'2', key:'p2', score:scores.p2 },
    ].sort((a,b)=>b.score-a.score);

    order.forEach((p)=>{
      const row = document.createElement('div');
      row.className='row';
      const pill = document.createElement('div');
      pill.className='player-pill';
      pill.innerHTML = `<span>ÿßŸÑŸÑÿßÿπÿ® ${p.id}</span> <span aria-hidden="true">üë§</span> <span class="score-chip">${p.score}</span>`;
      row.appendChild(pill);
      rankBox.appendChild(row);
    });
  }

  document.getElementById('start-btn').addEventListener('click', ()=>{
    show('game');
    leftAnswers.innerHTML = rightAnswers.innerHTML = '';
    qText.textContent=''; qColor.style.background='transparent';
    startCountdownThenGame();
  });

  document.getElementById('play-again').addEventListener('click', ()=>{
    show('game');
    startCountdownThenGame();
  });

  document.getElementById('back-home').addEventListener('click', ()=>{
    clearTimer();
    show('start');
  });

  document.addEventListener('keydown', e=>{
    if(e.key==='Escape' && screens.game.classList.contains('active')){
      document.getElementById('back-home').click();
    }
  });
</script>
</body>
</html>
